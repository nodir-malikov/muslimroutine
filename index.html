<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muslim Routine | Uzbekistan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/ru.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #e2e8f0;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1e293b;
        }

        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Glassmorphism Cards */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .active-card {
            border-left: 4px solid #10b981;
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(30, 41, 59, 0.7) 100%);
        }
    </style>
</head>

<body class="min-h-screen flex justify-center selection:bg-emerald-500 selection:text-white pb-10">

    <div class="w-full max-w-3xl px-4 py-6">

        <header class="mb-6 space-y-4">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-500">
                    <i class="fas fa-kaaba mr-2 text-emerald-400"></i>Muslim Routine
                </h1>
                <div class="text-xs text-slate-500 font-mono">v2.0 Pro</div>
            </div>

            <div class="glass p-4 rounded-xl grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs text-slate-400 mb-1">–†–µ–≥–∏–æ–Ω (Islom.uz)</label>
                    <select id="region-select" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-emerald-500 transition-colors">
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-slate-400 mb-1">–î–∞—Ç–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</label>
                    <input type="date" id="date-select" class="w-full bg-slate-800 border border-slate-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-emerald-500 text-white scheme-dark">
                </div>
            </div>
        </header>

        <div id="dashboard" class="mb-8 hidden">
            <div class="bg-gradient-to-r from-emerald-900 to-slate-900 rounded-2xl p-6 border border-emerald-500/20 shadow-lg relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                    <i class="fas fa-clock text-9xl text-emerald-400"></i>
                </div>

                <div class="relative z-10">
                    <p class="text-emerald-400 text-sm font-medium uppercase tracking-wider mb-1">–°–ª–µ–¥—É—é—â–µ–µ —Å–æ–±—ã—Ç–∏–µ</p>
                    <h2 id="next-event-name" class="text-3xl font-bold text-white mb-2">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
                    <div class="flex items-baseline gap-2">
                        <span id="countdown" class="text-4xl font-mono text-white font-bold">--:--:--</span>
                        <span class="text-slate-400 text-sm">–æ—Å—Ç–∞–ª–æ—Å—å</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="error-box" class="hidden bg-red-900/50 border border-red-500 text-red-200 p-4 rounded-lg mb-6 text-sm text-center"></div>

        <div id="loader" class="text-center py-20">
            <i class="fas fa-circle-notch fa-spin text-4xl text-emerald-500"></i>
        </div>

        <div id="timeline" class="space-y-4 relative hidden">
            <div class="absolute left-6 top-4 bottom-4 w-0.5 bg-slate-700 z-0"></div>
        </div>

        <footer class="mt-10 text-center text-xs text-slate-600">
            –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã <a href="https://islom.uz" target="_blank" class="underline hover:text-emerald-500">Islom.uz</a>
        </footer>
    </div>

    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        dayjs.locale('ru');

        // –°–ø–∏—Å–æ–∫ ID —Ä–µ–≥–∏–æ–Ω–æ–≤ –¥–ª—è Islom.uz API
        const REGIONS = [{
                id: 1,
                name: 'Toshkent'
            },
            {
                id: 2,
                name: 'Andijon'
            },
            {
                id: 3,
                name: 'Buxoro'
            },
            {
                id: 4,
                name: 'Guliston'
            },
            {
                id: 5,
                name: 'Jizzax'
            },
            {
                id: 6,
                name: 'Navoiy'
            },
            {
                id: 7,
                name: 'Namangan'
            },
            {
                id: 8,
                name: 'Nukus'
            },
            {
                id: 9,
                name: 'Samarqand'
            },
            {
                id: 10,
                name: 'Termiz'
            },
            {
                id: 11,
                name: 'Urganch'
            },
            {
                id: 12,
                name: 'Farg\'ona'
            },
            {
                id: 13,
                name: 'Xiva'
            },
            {
                id: 14,
                name: 'Qo\'qon'
            }
        ];

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            regionId: localStorage.getItem('muslimDev_regionId') || 1, // –ü–æ –¥–µ—Ñ–æ–ª—Ç—É –¢–∞—à–∫–µ–Ω—Ç
            date: dayjs().format('YYYY-MM-DD'), // –ü–æ –¥–µ—Ñ–æ–ª—Ç—É —Å–µ–≥–æ–¥–Ω—è
            schedule: []
        };

        // DOM –≠–ª–µ–º–µ–Ω—Ç—ã
        const els = {
            regionSelect: document.getElementById('region-select'),
            dateSelect: document.getElementById('date-select'),
            timeline: document.getElementById('timeline'),
            loader: document.getElementById('loader'),
            errorBox: document.getElementById('error-box'),
            dashboard: document.getElementById('dashboard'),
            nextEventName: document.getElementById('next-event-name'),
            countdown: document.getElementById('countdown')
        };

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function init() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–µ–ª–µ–∫—Ç —Ä–µ–≥–∏–æ–Ω–æ–≤
            REGIONS.forEach(reg => {
                const opt = document.createElement('option');
                opt.value = reg.id;
                opt.textContent = reg.name;
                if (reg.id == state.regionId) opt.selected = true;
                els.regionSelect.appendChild(opt);
            });

            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É –≤ –∏–Ω–ø—É—Ç
            els.dateSelect.value = state.date;

            // –°–ª—É—à–∞—Ç–µ–ª–∏ —Å–æ–±—ã—Ç–∏–π
            els.regionSelect.addEventListener('change', (e) => {
                state.regionId = e.target.value;
                localStorage.setItem('muslimDev_regionId', state.regionId);
                fetchData();
            });

            els.dateSelect.addEventListener('change', (e) => {
                state.date = e.target.value;
                fetchData();
            });

            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
            setInterval(updateCountdown, 1000);

            // –ü–µ—Ä–≤—ã–π —Ñ–µ—Ç—á
            fetchData();
        }

        // --- –õ–û–ì–ò–ö–ê –î–ê–ù–ù–´–• ---
        async function fetchData() {
            showLoader(true);
            els.errorBox.classList.add('hidden');

            try {
                const selectedDate = dayjs(state.date);
                const month = selectedDate.month() + 1; // API 1-12
                const region = REGIONS.find(r => r.id == state.regionId).name;

                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –º–µ—Å—è—á–Ω—ã–π API, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤—ã–±–∏—Ä–∞—Ç—å –ª—é–±—É—é –¥–∞—Ç—É
                const url = `https://islomapi.uz/api/monthly?region=${region}&month=${month}`;

                const res = await fetch(url);
                if (!res.ok) throw new Error("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º Islom.uz");

                const data = await res.json();

                // –ù–∞—Ö–æ–¥–∏–º –Ω—É–∂–Ω—ã–π –¥–µ–Ω—å –≤ –º–∞—Å—Å–∏–≤–µ
                const dayData = data.find(d => d.day === selectedDate.date());

                if (!dayData) throw new Error("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –¥–∞—Ç—ã");

                generateSchedule(dayData.times, selectedDate);
                showLoader(false);
                els.dashboard.classList.remove('hidden');

            } catch (err) {
                console.error(err);
                showLoader(false);
                els.errorBox.textContent = `–û—à–∏–±–∫–∞: ${err.message}`;
                els.errorBox.classList.remove('hidden');
                els.timeline.innerHTML = '';
                els.dashboard.classList.add('hidden');
            }
        }

        // --- –ì–ï–ù–ï–†–ê–¢–û–† –†–ê–°–ü–ò–°–ê–ù–ò–Ø ---
        function generateSchedule(times, dateObj) {
            // times: { tong_saharlik, peshin, asr, shom_iftor, hufton }
            const isFriday = dateObj.day() === 5;
            const schedule = [];

            // –•–µ–ª–ø–µ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Date –æ–±—ä–µ–∫—Ç–∞ –∏–∑ –≤—Ä–µ–º–µ–Ω–∏ "HH:mm"
            const makeTime = (timeStr) => {
                const [h, m] = timeStr.split(':');
                return dateObj.hour(h).minute(m).second(0);
            };

            const fajrTime = makeTime(times.tong_saharlik);
            const dhuhrTime = makeTime(times.peshin);
            const asrTime = makeTime(times.asr);
            const maghribTime = makeTime(times.shom_iftor);
            const ishaTime = makeTime(times.hufton);

            // 1. –£–¢–†–û
            schedule.push({
                time: fajrTime.subtract(40, 'minute'),
                title: "–¢–∞—Ö–∞–¥–∂—É–¥ & –°—É—Ö—É—Ä",
                icon: "fa-moon",
                color: "text-indigo-400",
                desc: "–û–º–æ–≤–µ–Ω–∏–µ, –≤–æ–¥–∞. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –§–∞–¥–∂—Ä—É."
            });

            schedule.push({
                time: fajrTime,
                title: "–§–∞–¥–∂—Ä (–ë–æ–º–¥–æ–¥)",
                icon: "fa-mosque",
                color: "text-emerald-400",
                desc: "–í –º–µ—á–µ—Ç–∏. –ö–æ—Ä–∞–Ω + –∑–∏–∫—Ä. –ù–∞—á–Ω–∏ –¥–µ–Ω—å —Å –ø–æ–±–µ–¥—ã."
            });

            // 2. DEEP WORK
            schedule.push({
                time: fajrTime.add(45, 'minute'),
                title: "üî• Deep Work",
                icon: "fa-laptop-code",
                color: "text-amber-400",
                desc: "<b>–ö–æ–¥–∏–Ω–≥/–ü–æ–≥—Ä—É–∂–µ–Ω–∏–µ:</b> –°–∞–º—ã–µ —Å–ª–æ–∂–Ω—ã–µ –∑–∞–¥–∞—á–∏. –¢–µ–ª–µ—Ñ–æ–Ω –≤ –∞–≤–∏–∞—Ä–µ–∂–∏–º–µ."
            });

            // 3. –û–ë–ï–î / –î–ñ–£–ú–ê
            if (isFriday) {
                schedule.push({
                    time: dhuhrTime.subtract(30, 'minute'), // –ß—É—Ç—å —Ä–∞–Ω—å—à–µ –¥–ª—è –î–∂—É–º–∞
                    title: "üïå –î–∂—É–º–∞ –ù–∞–º–∞–∑",
                    icon: "fa-users",
                    color: "text-emerald-300",
                    desc: "–ì—É—Å–ª—å, –°—É–Ω–Ω–∞, –•—É—Ç–±–∞. –û—Å—Ç–∞–≤—å—Ç–µ —Ç–æ—Ä–≥–æ–≤–ª—é –∏ –∫–æ–¥."
                });
            } else {
                schedule.push({
                    time: dhuhrTime,
                    title: "–ó—É—Ö—Ä (–ü–µ—à–∏–Ω)",
                    icon: "fa-sun",
                    color: "text-orange-400",
                    desc: "–ù–∞–º–∞–∑. –ü–µ—Ä–µ—Ä—ã–≤ –¥–ª—è –≥–ª–∞–∑."
                });
                // –°–ø–æ—Ä—Ç –∑–∏–º–æ–π –ª—É—á—à–µ –¥–Ω–µ–º
                schedule.push({
                    time: dhuhrTime.add(20, 'minute'),
                    title: "üèãÔ∏è‚Äç‚ôÇÔ∏è Gym & –û–±–µ–¥",
                    icon: "fa-dumbbell",
                    color: "text-red-400",
                    desc: "–†–∞–∑–≥—Ä—É–∑–∫–∞ –º–æ–∑–≥–∞. –û–±–µ–¥: –ë–µ–ª–æ–∫ + –ö–ª–µ—Ç—á–∞—Ç–∫–∞."
                });
            }

            // 4. –í–¢–û–†–ê–Ø –ü–û–õ–û–í–ò–ù–ê
            schedule.push({
                time: asrTime,
                title: "–ê—Å—Ä",
                icon: "fa-cloud-sun",
                color: "text-blue-300",
                desc: "–í—Ç–æ—Ä–æ–π —Ä–∞–±–æ—á–∏–π –±–ª–æ–∫: Admin, Calls, Learning."
            });

            // 5. –í–ï–ß–ï–†
            schedule.push({
                time: maghribTime,
                title: "–ú–∞–≥—Ä–∏–± (–®–æ–º)",
                icon: "fa-star-and-crescent",
                color: "text-purple-400",
                desc: "–ò—Ñ—Ç–∞—Ä/–£–∂–∏–Ω. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–≥–æ –¥–Ω—è (15 –º–∏–Ω)."
            });

            schedule.push({
                time: maghribTime.add(30, 'minute'), // –û–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ 30 –º–∏–Ω –ø–æ—Å–ª–µ –º–∞–≥—Ä–∏–±–∞ —É–∂–µ –¥–æ–º–∞
                title: "–°–µ–º—å—è & –û—Ç–¥—ã—Ö",
                icon: "fa-home",
                color: "text-pink-400",
                desc: "–í—Ä–µ–º—è —Å –±–ª–∏–∑–∫–∏–º–∏."
            });

            // 6. –ò–®–ê –∏ –°–û–ù
            // 3-2-1 Rule (—Å—Ç–∞—Ç–∏—á–Ω–æ –∑–∞ 3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞, –¥–æ–ø—É—Å—Ç–∏–º —Å–æ–Ω –≤ 22:00)
            schedule.push({
                time: dateObj.hour(19).minute(0),
                title: "‚õî 3-2-1: –°—Ç–æ–ø",
                icon: "fa-ban",
                color: "text-gray-500",
                desc: "3 —á–∞—Å–∞ –¥–æ —Å–Ω–∞ - –Ω–µ –µ—Å—Ç—å, 2 - –Ω–µ –ø–∏—Ç—å, 1 - –Ω–µ—Ç —ç–∫—Ä–∞–Ω–∞–º."
            });

            schedule.push({
                time: ishaTime,
                title: "–ò—à–∞ (–•—É—Ñ—Ç–æ–Ω)",
                icon: "fa-star",
                color: "text-slate-300",
                desc: "–ù–∞–º–∞–∑. –ö–æ—Ä–∞–Ω + –∑–∏–∫—Ä. –°—É—Ä–∞ –ê–ª—å-–ú—É–ª—å–∫."
            });

            schedule.push({
                time: dateObj.hour(22).minute(0), // –¶–µ–ª—å —Å–Ω–∞
                title: "–°–æ–Ω",
                icon: "fa-bed",
                color: "text-blue-600",
                desc: "–¢–µ–º–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ."
            });

            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
            schedule.sort((a, b) => a.time.valueOf() - b.time.valueOf());

            state.schedule = schedule;
            renderTimeline();
        }

        // --- –û–¢–†–ò–°–û–í–ö–ê ---
        function renderTimeline() {
            els.timeline.innerHTML = '<div class="absolute left-6 top-4 bottom-4 w-0.5 bg-slate-700 z-0"></div>'; // –õ–∏–Ω–∏—è

            const now = dayjs();
            let nextEventFound = false;

            state.schedule.forEach((item, index) => {
                const isPast = now.isAfter(item.time);
                const isNext = !isPast && !nextEventFound;

                if (isNext) {
                    nextEventFound = true;
                    updateDashboard(item);
                }

                const timeStr = item.time.format('HH:mm');
                const activeClass = isNext ? 'active-card ring-2 ring-emerald-500/50' : 'glass';
                const opacityClass = isPast ? 'opacity-50' : 'opacity-100';

                const html = `
                <div class="relative pl-12 group ${opacityClass}">
                    <div class="absolute left-6 w-3 h-3 rounded-full bg-slate-600 border-2 border-slate-800 -translate-x-1.5 mt-5 z-10 ${isNext ? 'bg-emerald-500 animate-pulse' : ''}"></div>
                    
                    <div class="${activeClass} p-4 rounded-xl transition-all duration-300 hover:bg-slate-800/80">
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-bold text-lg ${item.color} flex items-center gap-2">
                                <i class="fas ${item.icon} w-5 text-center"></i> ${item.title}
                            </h3>
                            <span class="font-mono text-lg text-slate-300 bg-black/20 px-2 rounded">${timeStr}</span>
                        </div>
                        <p class="text-sm text-slate-400 ml-7">${item.desc}</p>
                    </div>
                </div>
            `;
                els.timeline.insertAdjacentHTML('beforeend', html);
            });

            if (!nextEventFound && state.schedule.length > 0) {
                // –ï—Å–ª–∏ –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ—à–ª–∏, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–ö–æ–Ω–µ—Ü –¥–Ω—è" –∏–ª–∏ "–§–∞–¥–∂—Ä" —Å–ª–µ–¥ –¥–Ω—è
                els.nextEventName.textContent = "–î–µ–Ω—å –∑–∞–≤–µ—Ä—à–µ–Ω";
                els.countdown.textContent = "00:00:00";
            }
        }

        function updateDashboard(nextItem) {
            els.nextEventName.textContent = nextItem.title;
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ü–µ–ª–µ–≤–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Ç–∞–π–º–µ—Ä–∞
            state.nextEventTime = nextItem.time;
            updateCountdown(); // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ä–∞–∑—É
        }

        function updateCountdown() {
            if (!state.nextEventTime) return;

            const now = dayjs();
            const diff = state.nextEventTime.diff(now);

            if (diff <= 0) {
                // –ï—Å–ª–∏ —Ç–∞–π–º–µ—Ä –∏—Å—Ç–µ–∫, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—É—Å (–º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –Ω–æ –ø—Ä–æ—â–µ –æ–±–Ω–æ–≤–∏—Ç—å —Ä–µ–Ω–¥–µ—Ä)
                if (Math.abs(diff) < 2000) renderTimeline(); // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ –∏—Å—Ç–µ–∫
                return;
            }

            const h = Math.floor(diff / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);

            els.countdown.textContent =
                `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function showLoader(show) {
            if (show) {
                els.loader.classList.remove('hidden');
                els.timeline.classList.add('hidden');
            } else {
                els.loader.classList.add('hidden');
                els.timeline.classList.remove('hidden');
            }
        }

        // –°—Ç–∞—Ä—Ç
        init();
    </script>
</body>

</html>